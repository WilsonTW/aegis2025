# **è»Ÿé«”éœ€æ±‚è¦æ ¼æ›¸ (SRS) - èƒ½æºç®¡ç†ç³»çµ±**

## **1. ç³»çµ±æ¦‚è¿°**
æœ¬ç³»çµ±ç‚ºä¸€å€‹å®Œæ•´çš„èƒ½æºç®¡ç†å¾Œç«¯ï¼Œæä¾›è¨­å‚™ç®¡ç†ã€èƒ½æºæ’ç¨‹ã€å ±ä¿®ç®¡ç†ã€äº‹ä»¶èˆ‡é€šçŸ¥ç®¡ç†ã€ç”¨æˆ¶èˆ‡æ¬Šé™ç®¡ç†ï¼Œä»¥åŠè²¡å‹™å ±è¡¨åŠŸèƒ½ã€‚

### **1.1 ç›®æ¨™èˆ‡ç¯„åœ**
- é€é API ç®¡ç†ä¸åŒé¡å‹çš„è¨­å‚™ (å‰µèƒ½ã€å„²èƒ½ã€è² è¼‰è¨­å‚™)
- æä¾›èƒ½æºæ’ç¨‹æ§åˆ¶èˆ‡æ™ºèƒ½èª¿åº¦
- æ•´åˆå ±ä¿®ç®¡ç†èˆ‡äº‹ä»¶é€šçŸ¥
- æä¾›ç”¨æˆ¶èˆ‡è§’è‰²æ¬Šé™ç®¡ç†
- å…è¨±æŸ¥è©¢è¨­å‚™æ•¸æ“šä¸¦é€²è¡Œæ•¸æ“šåˆ†æ
- é€éæ™ºæ…§åŒ–èª¿æ•´æé«˜èƒ½æºä½¿ç”¨æ•ˆç‡

---

## **2. åŠŸèƒ½éœ€æ±‚**

### **2.1 è¨­å‚™ç®¡ç†**
| æ–¹æ³•   | è·¯å¾‘                          | èªªæ˜                     | åƒæ•¸ |
|--------|------------------------------|--------------------------|------------------------------------------------|
| **GET**    | `/api/devices`               | æŸ¥è©¢æ‰€æœ‰è¨­å‚™             | `type` (é¸å¡«: `load`, `storage`, `generation`), `status` |
| **POST**   | `/api/devices`               | æ–°å¢è¨­å‚™                 | `{ "name": "string", "type": "string", "status": "string", "location": "string" }` |
| **PATCH**  | `/api/devices/{id}`          | ä¿®æ”¹è¨­å‚™                 | `{ "name"?: "string", "status"?: "string", "location"?: "string" }` |
| **DELETE** | `/api/devices/{id}`          | åˆªé™¤è¨­å‚™                 | `id` (è¨­å‚™ ID) |
| **GET**    | `/api/device_datas/query`    | æŸ¥è©¢è¨­å‚™ç‹€æ…‹èˆ‡æ­·å²æ•¸æ“š   | `device_id`, `start_time`, `end_time` |
| **GET**    | `/api/device_types`          | æŸ¥è©¢è¨­å‚™é¡å‹             | ç„¡ |

### **2.2 èƒ½æºæ’ç¨‹ç®¡ç†**
| æ–¹æ³•   | è·¯å¾‘                                   | èªªæ˜                          | åƒæ•¸ |
|--------|--------------------------------------|------------------------------|------------------------------------------------|
| **GET**    | `/api/power_schedulers`            | æŸ¥è©¢æ’ç¨‹                     | `device_id`, `status` |
| **POST**   | `/api/power_schedulers`            | æ–°å¢æ’ç¨‹                     | `{ "device_id": "number", "cron": "string", "action": "string" }` |
| **PATCH**  | `/api/power_schedulers/{id}`       | ä¿®æ”¹æ’ç¨‹                     | `{ "cron"?: "string", "action"?: "string" }` |
| **DELETE** | `/api/power_schedulers/{id}`       | åˆªé™¤æ’ç¨‹                     | `id` (æ’ç¨‹ ID) |
| **POST**   | `/api/power_schedulers/update_cron_tasks` | æ›´æ–° CRON ä»»å‹™         | ç„¡ |
| **GET**    | `/api/power_schedulers/load_balance` | æŸ¥è©¢è² è¼‰ç‹€æ³ä¸¦å»ºè­°èª¿æ•´   | ç„¡ |
| **POST**   | `/api/power_schedulers/adjust_schedule` | å‹•æ…‹èª¿æ•´æ’ç¨‹             | `{ "device_id": "number", "new_schedule": "string" }` |
| **GET**    | `/api/power_schedulers/price_optimization` | æ ¹æ“šé›»åƒ¹èª¿æ•´é‹è¡Œç­–ç•¥ | `price_threshold`, `action` |

### **2.3 å„²èƒ½è¨­å‚™ç®¡ç†**
| æ–¹æ³•   | è·¯å¾‘                        | èªªæ˜                      | åƒæ•¸ |
|--------|----------------------------|--------------------------|------------------------------------------------|
| **POST**   | `/api/storage/charge_control` | è¨­å®šå„²èƒ½å……æ”¾é›»ç­–ç•¥     | `{ "device_id": "number", "charge_threshold": "number", "discharge_threshold": "number", "grid_export": "boolean" }` |
| **GET**    | `/api/storage/status`        | æŸ¥è©¢å„²èƒ½è¨­å‚™ç‹€æ…‹       | `device_id` |
| **GET**    | `/api/storage/grid_export`   | é›»ç¶²è¼¸å‡ºé™åˆ¶           | `device_id` |

### **2.4 å‰µèƒ½è¨­å‚™ç®¡ç†**
| æ–¹æ³•   | è·¯å¾‘                          | èªªæ˜                          | åƒæ•¸ |
|--------|------------------------------|------------------------------|------------------------------------------------|
| **POST**   | `/api/generation/set_priority` | è¨­å®šç™¼é›»è¨­å‚™å„ªå…ˆç­–ç•¥     | `{ "device_id": "number", "priority": "string", "max_export": "number" }` |
| **POST**   | `/api/generation/adjust_output` | å³æ™‚èª¿æ•´ç™¼é›»è¼¸å‡º         | `{ "device_id": "number", "output_level": "number" }` |
| **GET**    | `/api/generation/status`      | æŸ¥è©¢ç™¼é›»è¨­å‚™ç‹€æ…‹         | `device_id` |

### **2.5 äº‹ä»¶èˆ‡é€šçŸ¥ç®¡ç†**
| æ–¹æ³•   | è·¯å¾‘                          | èªªæ˜                  | åƒæ•¸ |
|--------|------------------------------|----------------------|------------------------------------------------|
| **POST**   | `/api/notify_phone`           | æ‰‹æ©Ÿé€šçŸ¥            | `{ "user_id": "number", "message": "string" }` |
| **GET**    | `/api/events`                 | æŸ¥è©¢äº‹ä»¶            | `event_type`, `status` |
| **POST**   | `/api/events`                 | å‰µå»ºäº‹ä»¶            | `{ "type": "string", "description": "string", "priority": "string" }` |
| **PATCH**  | `/api/events/{id}`            | ä¿®æ”¹äº‹ä»¶            | `{ "type"?: "string", "status"?: "string" }` |
| **DELETE** | `/api/events/{id}`            | åˆªé™¤äº‹ä»¶            | `id` (äº‹ä»¶ ID) |
| **GET**    | `/api/alerts`                 | è¨­å‚™ç•°å¸¸é€šçŸ¥        | `device_id`, `severity` |
| **GET**    | `/api/repair_orders/updates`  | æŸ¥è©¢å ±ä¿®ç‹€æ…‹æ›´æ–°    | `repair_order_id` |

(è¡¨æ ¼æ’ç‰ˆå·²å„ªåŒ–ï¼Œç¢ºä¿åœ¨ä¸åŒå¹³å°ä¸Šé¡¯ç¤ºæ¸…æ™°ä¸”åƒæ•¸æ˜“æ–¼é–±è®€)

---

## **3. æ•¸æ“šæµèˆ‡æ¥­å‹™é‚è¼¯**
### **3.1 èƒ½æºæ’ç¨‹é‚è¼¯**
1. **ç³»çµ±æ ¹æ“šè¨­å‚™çš„é¡å‹ (å‰µèƒ½/å„²èƒ½/è² è¼‰) è¨ˆç®—æ’ç¨‹**
2. **ç”¨æˆ¶è¨­å®šæ’ç¨‹ (é–‹é—œæ™‚é–“ / è² è¼‰ç­–ç•¥)**
3. **ç³»çµ±æ ¹æ“šè² è¼‰æƒ…æ³èˆ‡é›»åƒ¹èª¿æ•´è¨ˆåŠƒ**
4. **æ ¹æ“šå„ªå…ˆç´šæ±ºå®šè¨­å‚™çš„é–‹é—œé †åº**
5. **è¨­å‚™é‹è¡Œä¸¦è¨˜éŒ„æ•¸æ“š**

### **3.2 å„²èƒ½èˆ‡ç™¼é›»ç­–ç•¥**
1. **ç³»çµ±ç›£æ¸¬é›»åƒ¹èˆ‡ç™¼é›»é‡**
2. **ä½é›»åƒ¹æ™‚å……é›»ï¼Œé«˜é›»åƒ¹æ™‚æ”¾é›»**
3. **éè¼‰æ™‚å„ªå…ˆé‡‹æ”¾å„²èƒ½é›»åŠ›**

---

## **4. æœªä¾†æ“´å±•æ€§èˆ‡é–‹ç™¼å»ºè­°**
### **4.1 å¯èƒ½çš„æ“´å±•æ–¹å‘**
- **AI é æ¸¬èƒ½æºéœ€æ±‚ï¼Œé€²ä¸€æ­¥å„ªåŒ–æ’ç¨‹**
- **å¢åŠ  WebSocketï¼Œæä¾›å³æ™‚ç›£æ¸¬è¨­å‚™ç‹€æ…‹**
- **æ•´åˆå€å¡Šéˆï¼Œæ”¯æ´èƒ½æºäº¤æ˜“åŠŸèƒ½**

### **4.2 é–‹ç™¼å»ºè­°**
- **ä½¿ç”¨ NestJS ä½œç‚ºå¾Œç«¯æ¡†æ¶ï¼Œç¢ºä¿å¯æ“´å±•æ€§**
- **æ¡ç”¨ InfluxDB å„²å­˜æ™‚åºæ•¸æ“šï¼Œæé«˜æŸ¥è©¢æ•ˆèƒ½**
- **å‰ç«¯å¯ä½¿ç”¨ Vue.js æˆ– React ä½œç‚º UI æ¡†æ¶**

---

## **5. çµè«–**
æœ¬ SRS æ–‡ä»¶è©³ç´°æè¿°äº†èƒ½æºç®¡ç†ç³»çµ±çš„åŠŸèƒ½èˆ‡ APIï¼Œä¸¦æä¾›äº†æœªä¾†æ“´å±•æ€§å»ºè­°ã€‚å¯ä½œç‚ºé–‹ç™¼åœ˜éšŠçš„åƒè€ƒæŒ‡å—ï¼Œä»¥ç¢ºä¿ç³»çµ±ç¬¦åˆéœ€æ±‚ä¸¦å…·æœ‰è‰¯å¥½çš„å¯æ“´å±•æ€§ã€‚

---

**ğŸ“Œ é€™ä»½ SRS æ–‡ä»¶å¯ä»¥ä½œç‚ºé–‹ç™¼åœ˜éšŠçš„åƒè€ƒï¼Œè«‹ç¢ºèªæ˜¯å¦é‚„éœ€è¦é€²ä¸€æ­¥èª¿æ•´ï¼** ğŸš€

